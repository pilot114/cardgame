
АХТУНГ!!!!
die.friendlyMinion и прочие эвенты некорректно учитывают сторону
(умереть существо может во время хода любого игрока)
ПОФИКСАТЬ!!!


http://eu.battle.net/hearthstone/ru/forum/topic/9413171290


расчертил план сущностей - что во что входит

концепция events и actions

концепция разделения:
  backend - логика, данные, логи
  frontend - отрисовка, UI

BACKEND
пилим наброски классов (пока без методов бизнес логики)
Card - доступные и недоступные по умолчанию
наметил коллекции - для простоты это враппер над массивом Card
коллекции - deck, minions (2), hand, gone
Heroes - только два, самые простые в реализации - Маг и Охотник
И! Table Board Game

Game - самый интересный класс. Он организует eventloop,
ждущий команд с коннекта и только он работает с events и actions.
По сути, именно он реализует весь геймплей. (В дальнейшем, возможно,
потребуется разбить его на более мелкие составляющие). Соответсвенно,
здесь же ведётся лог игры.

Делаем демо набор карт - по 12 штук с каждой стороны.
по 5 из них - классовые. + 3 карты, которые можно только призвать.
итого 27.

Первая цель - сыграть неинтерактивный сценарий, используя классы,
заодно написать тесты. Без доп.фич вроде мулигана и фатига
(урон, когда закончилась колода)

В ходе написания сценария, "придумался" класс Connect, который инкапсулирует
в себе получение действий игроков и возвращение ответов для них.
Наметился вполне конкретный и лаконичный набор основных действий игрока
(1 клик - 1 действие):
сыграть абилку, ударить, выбрать карту, разыграть карту. Абилка или розыгрыш карты может быть с таргетом. Удар всегда с таргетом. Таргетом может быть персонаж или место на столе (когда разыгрываем существо).
С обработкой ошибок все стандартно - информативная обработка на клиенте
и просто с кодом и мессагой ошибки на сервере, для тестирования и для читеров (=

Функциональные тесты в условиях рандома практически бесполезны.
При включенном дебаге информация о происходящем идёт на стандартный вывод WsServer.php,
при выключенном - в лог.

Для выбора или призыва некоторого подмножества карт используется селектор:
это или число (id карты) или массив свойств (сравнение по параметрам, класс, редкость, роль).
Примеры: 12, 'attack>=5', 'paladin', 'common', 'beast'. Соответственно, запрос по селектору
может осуществляться на любой коллекции: 'hand', 'deck', 'gone' и т.д.
(Collection::select)

Конечно, изначально хотелось сделать очень легкие калбэки на картах, чтобы максимально упростить их добавление.
Но после размышлений об удостве дебага, я решил взять за правило максимально "освободить" код самого симулятора.
Никаких хелперов, менеджеров и репозиториев - при правильной архитектуре все промежуточные слои
логики легко пишутся ретроспективно (https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D1%82%D1%80%D0%BE%D1%81%D0%BF%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%B0_%D0%B2_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8)
Например, все рандомные эффекты карт и логи о результате срабатывания листенеров сейчас описываются
в самих картах (что, впрочем, вполне логично)

Чтобы не путать стороны, я пришел к следующему соглашению:
top и bottom - неизменны, это то что находиться сверху и снизу на столе относительно игрока A.
friendlySide и enemySide - ссылки на top и bottom, которые меняются каждый ход.
т.е. friendlySide - это всегда та сторона, которая ходит в данный момент, и практически
всегда для доступа к картам на столе используются именно friendlySide и enemySide.

При написании логики карты (особенно листенеров) следует всегда держать в голове,
когда именно будет выполняться код. Например, при срабатывании секрета 'Взрывная ловушка',
в листенере выбираются все ДРУЖЕСКИЕ миньоны, ведь в этот момент идёт ход противника
и вражеские миньоны находятся в friendlySide.
